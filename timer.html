<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="images/fav.png">

    <title>C'est parti !</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

    <!-- Bootstrap core CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" rel="stylesheet">
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
	<link href="css/accueil.css" rel="stylesheet">
    <link href="css/timer.css" rel="stylesheet">

	<script type="text/javascript" src="js/timer.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
<body>
	<div class="container">

		<div class="jumbotron">

			<!-- Chronomètre -->
			<span id="chronotime">00:00:00:00</span>
			
			<form name="chronoForm">
			<script type="text/javascript" src="js/timer.js"></script>
			</form>

			<!-- Pile -->
      <div class="row" style="margin-bottom:6em;">
        <div class="col-lg-12">
          <h4>Vous avez permis d'alimenter pendant un heure l'équivalent de :</h4>
        </div>
          <div class="col-lg-3">
            <div class="row">
              <h5 class="col-lg-8"><span id="smartphone">0</span>x <i class="fa fa-mobile fa-2x"></i> </h5>
                <h5 class="col-lg-4">
                    ou
                </h5>
            </div>
          </div>

          <div class="col-lg-3">
            <div class="row">
              <h5 class="col-lg-8"><span id="ampoule">0</span>x <i class="fa fa-lightbulb-o fa-2x"></i> </h5>
                <h5 class="col-lg-4">
                    ou
                </h5>
            </div>
          </div>

          <div class="col-lg-3">
            <div class="row">
              <h5 class="col-lg-8"><span id="tele">0</span>x <i class="fa fa-television fa-2x"></i> </h5>
                <h5 class="col-lg-4">
                    ou
                </h5>
            </div>
          </div>

          <div class="col-lg-3">
            <div class="row">
              <h5 class="col-lg-8"><span id="ordi">0</span>x <i class="fa fa-desktop fa-2x"></i> </h5>

            </div>
          </div>


      </div>

      <center>
			<div id="mydiv">
				<img id="image" src="images/batterie.png">
				<h2 id="text"></h2>

			</div>
      <br>
      <br>
      <br>




			</center>
			</p>
			<br/>
			<br/>
			<br/>

				<script type="text/javascript" src="js/pile.js"></script>
            <script type="text/javascript">

function setPile(percent) {
    var val = Math.floor(100 - percent);
    $("#mydiv").css('background','linear-gradient(to bottom, white 0%,white ' + val +'%' + ',rgba(64,187,106,1) '+ val+ '%)');
	 document.getElementById("text").innerHTML = Math.floor(percent) + " %";
}
function parHeure(totale,watt){
    return Math.floor(totale/watt)
}
var nbPile = 0.0
var total = 0.0;
var startTimer = false;
var afkCount = 0;
var maxPile = 5000;
window.setInterval(function(){
    $.ajax({
        url : 'http://localhost:3000/watt',
        type : 'GET',
        success : function(code_html, statut){
            var value = parseFloat(code_html);
            if(afkCount > 20) {
                startTimer = false;
                afkCount = 0;
                total = 0;
                nbPile=0
                chronoStop();
            }
            if(startTimer) {
                total += value;
                var percent=((total-nbPile*maxPile)/maxPile)*100;
                if (percent > 100){
                    nbPile++;
                }
                percent=((total-nbPile*maxPile)/maxPile)*100;
                setPile(percent);
                $("#smartphone").text(parHeure(total,10));
                $("#ampoule").text(parHeure(total,60));
                $("#tele").text(parHeure(total,80));
                $("#ordi").text(parHeure(total,250));
                if(value == 0.0) {
                    afkCount++;
                }else {
                    afkCount = 0;
                }
            }
            if(value != 0.0 && !startTimer) {
                startTimer = true;
                chronoStart();
            }
            //console.log(total);
            //$("#number").text(code_html+" W");
        },
    });
},100);
            </script>

            <!-- Pavé des boutons -->
            <div class="boutons">
                <p>
                <a class="btn btn-lg btn-success" href="./accueil.html" role="button">Quitter</a>
                <a class="btn btn-lg btn-success" href="./records.html" role="button">Records</a>
                </p>
            </div>
        </div>

        <!-- Pied de page -->
        <footer class="footer">
            <p>Projet Intensif 2016 - Groupe 7 - Watt The Park </p>
        </footer>
    </div>


</body>

</html>
